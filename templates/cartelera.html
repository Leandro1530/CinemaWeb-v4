{% extends "base.html" %}
{% block title %}Cartelera | Cinema3D{% endblock %}

{% block head_extras %}
<style>
  /* Oculta los enlaces del footer SOLO en esta vista */
  .yx-footer .hstack{ display:none !important; }

  /* ===== Hero compacto ===== */
  .car-hero {
    max-width: min(1200px, 94%);
    margin: 0 auto 14px;
    padding: 12px 18px;
    border-radius: 16px;
    background: var(--surface);
    border: 1px solid rgba(255,255,255,.08);
    display: flex; justify-content: space-between; align-items: center; gap: 12px;
  }
  .car-hero .left { display:flex; align-items:center; gap:12px; }
  .car-hero .ico {
    width: 34px; height: 34px; border-radius: 10px;
    display:grid; place-items:center;
    background: rgba(79,109,245,.14); border:1px solid rgba(79,109,245,.28);
  }
  .car-hero h1 {
    margin:0; font-size: clamp(20px, 2.4vw, 28px); line-height:1.1; font-weight:800;
  }
  .car-hero .suc { color: var(--primary); }
  .car-hero .right .btn-ghost{
    padding:.5rem 1rem; border-radius:999px; background:rgba(255,255,255,.10);
    border:0; color:#fff; font-weight:700;
  }
  .car-hero .right .btn-ghost:hover{ background:rgba(255,255,255,.18); }

  @media (max-width: 640px){
    .car-hero{ flex-direction:column; align-items:flex-start; gap:10px; }
    .car-hero .right{ align-self:flex-start; }
  }

  /* ===== Grilla de películas (tarjetas más GRANDES) ===== */
  .movie-wrap { max-width: min(1200px, 94%); margin: 0 auto; }
  .movie-grid {
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 22px;
  }
  @media (max-width: 1100px){ .movie-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
  @media (max-width: 640px){ .movie-grid{ grid-template-columns: 1fr; } }

  .movie-card{
    background: linear-gradient(180deg, var(--card), color-mix(in srgb, var(--card) 70%, #000));
    border:1px solid rgba(255,255,255,.08);
    border-radius: 16px;
    box-shadow: 0 10px 28px rgba(0,0,0,.30);
    overflow: hidden;
    display:grid;
    grid-template-rows: auto 1fr;
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    min-height: 430px; /* hace la tarjeta más alta */
  }
  .movie-card:hover{
    transform: translateY(-4px);
    border-color: rgba(79,109,245,.30);
    box-shadow: 0 16px 42px rgba(20,30,60,.45);
  }

  /* Poster más grande (16:9 pero alto mayor gracias al ancho de la grid) */
  .movie-poster-horizontal{
    width:100%; aspect-ratio: 16/9; object-fit: cover; display:block;
    border-bottom:1px solid rgba(255,255,255,.08);
  }

  .movie-card .info{
    padding: 16px 16px 14px;
    display:grid; gap:10px;
  }
  .movie-card .info h3{
    margin:0; font-size: clamp(1.05rem, 1.8vw, 1.25rem); font-weight:800;
  }
  .movie-meta{
    display:flex; gap:8px; align-items:center;
    color: var(--muted); font-size: .98rem; flex-wrap: wrap;
  }
  .movie-sinopsis{ color:var(--muted); line-height:1.35; }

  /* ===== Bloque de funciones: botones grandes “pill” ===== */
  .funciones-block{ margin-top: 6px; }
  .funciones-title{ font-weight:800; font-size:.98rem; color:#cfe0ff; margin:0 0 6px; }

  .funciones-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
  }

  .show-btn{
    width:100%;
    padding: .65rem .9rem;
    border-radius: 999px;
    background: rgba(79,109,245,.14);
    border: 1px solid rgba(79,109,245,.30);
    color:#eaf0ff; font-weight:800; letter-spacing:.2px;
    cursor: pointer;
    transition: transform .15s ease, background .15s ease, border-color .15s ease;
    text-align:center;
  }
  .show-btn:hover{
    background: rgba(79,109,245,.22);
    border-color: rgba(79,109,245,.45);
    transform: translateY(-1px);
  }

  /* ===== Placeholders cuando hay menos de 3 ===== */
  .placeholder{
    background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--card);
    border:1px dashed rgba(255,255,255,.18);
    display:grid; place-items:center; text-align:center; padding: 24px;
    border-radius:16px; min-height:430px;
  }
  .placeholder h3{ margin:8px 0 0; }
  .placeholder .tag{
    display:inline-block; padding:.32rem .7rem; border-radius:999px;
    background:#1b2332; border:1px solid rgba(255,255,255,.10);
    font-weight:800; font-size:.82rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
  <!-- Hero -->
  <section class="car-hero">
    <div class="left">
      <div class="ico" aria-hidden="true">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <rect x="3" y="6" width="18" height="12" rx="3" fill="#4f6df5"/>
          <circle cx="12" cy="12" r="3" fill="#fff"/>
        </svg>
      </div>
      <h1>Cartelera <span class="suc">{{ sucursal }}</span></h1>
    </div>
    <div class="right">
      <a href="{{ url_for('main.bienvenida') }}" class="btn-ghost">Cambiar sucursal</a>
    </div>
  </section>

  {% if not movies %}
    <section class="movie-wrap">
      <div class="movie-card placeholder">
        <div>
          <span class="tag">Próximamente</span>
          <h3>Nuevos estrenos en camino…</h3>
          <p class="movie-sinopsis">Volvé más tarde para ver las próximas funciones.</p>
        </div>
      </div>
    </section>
  {% else %}
  <!-- Grid de películas -->
  <section class="movie-wrap">
    <div class="movie-grid">
      {% for m in movies %}
      <article class="movie-card">
        <img
          class="movie-poster-horizontal"
          src="{{ m['poster_url'] }}"
          alt="Póster de {{ m['titulo'] }}"
          loading="lazy" decoding="async" />

        <div class="info">
          <h3>{{ m['titulo'] }}</h3>

          <div class="movie-meta">
            <span>{{ m['genero'] }}</span><span>•</span>
            <span>{{ m['clasificacion'] }}</span><span>•</span>
            <span>{{ m['duracion_min'] }} min</span>
          </div>

          {% if m['sinopsis'] %}
          <p class="movie-sinopsis">{{ m['sinopsis'] }}</p>
          {% endif %}

          {% if m['funciones'] %}
          <div class="funciones-block">
            <div class="funciones-title">Funciones disponibles</div>
            <div class="funciones-grid">
              {% for f in m['funciones'] %}
                <form method="post" action="{{ url_for('venta.seleccionar_funcion') }}">
                  <input type="hidden" name="movie_id" value="{{ m['id'] }}">
                  <input type="hidden" name="funcion_idx" value="{{ loop.index0 }}">
                  <button type="submit" class="show-btn">
                    {{ f['fecha'] }} · {{ f['hora'] }} · {{ f['sala'] }}
                  </button>
                </form>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </article>
      {% endfor %}

      {# Si hay menos de 3, completamos con placeholders visuales #}
      {% if movies|length < 3 %}
        {% for _ in range(3 - movies|length) %}
        <article class="movie-card placeholder">
          <div>
            <span class="tag">Próximamente</span>
            <h3>Nueva película</h3>
            <p class="movie-sinopsis">Muy pronto en esta sala.</p>
          </div>
        </article>
        {% endfor %}
      {% endif %}
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}
