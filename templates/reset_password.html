{% extends "base.html" %}
{% block title %}Restablecer contrase√±a | Cinema3D{% endblock %}

{% block head_extras %}
<style>
  /* ===== Restablecer contrase√±a moderno ===== */
  .reset-wrap{
    min-height: calc(100dvh - 96px - 80px);
    display:flex; align-items:center; justify-content:center;
    padding: clamp(16px, 3vw, 28px);
  }
  .reset-card{
    width:min(440px, 100%);
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius: 20px;
    box-shadow: var(--shadow-sm);
    backdrop-filter: blur(14px);
    padding: clamp(18px, 3vw, 28px);
    animation: rsFade .35s ease both;
  }
  @keyframes rsFade{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none}}

  .reset-logo{
    width:84px; height:84px; border-radius:18px; margin:0 auto 14px;
    display:grid; place-items:center;
    background: linear-gradient(135deg,#10b981,#059669);
    box-shadow: 0 14px 34px rgba(16,185,129,.35);
  }
  .reset-title{ margin:0; text-align:center; font-weight:800; font-size: clamp(1.4rem,2.2vw,1.9rem); }
  .reset-sub{ text-align:center; color:var(--muted); margin:.35rem 0 0; }

  .form{ display:grid; gap:14px; margin-top: clamp(16px, 2.4vw, 22px); }

  .field{ display:grid; gap:.45rem; }
  .field label{ font-weight:600; color:#cfd6e5; }
  .control{
    position:relative;
    display:flex; align-items:center;
    background:#0f1428; border:1px solid rgba(255,255,255,.10);
    border-radius:12px; padding: 0 .8rem;
    transition: border-color .2s ease, background .2s ease, box-shadow .2s ease;
  }
  .control:focus-within{
    border-color:#10b981; background:#121936;
    box-shadow:0 0 0 3px rgba(16,185,129,.18);
  }
  .control .icon{ margin-right:.55rem; opacity:.9 }
  .control input{
    flex:1; height:44px; border:0; outline:0; background:transparent;
    color:var(--text); font-size:.98rem;
  }
  .toggle-pass{
    border:0; background:transparent; color:#9fb1ff; font-weight:700;
    cursor:pointer; padding:.25rem .2rem; margin-left:.3rem;
  }
  .toggle-pass:hover{ filter:brightness(1.1) }

  .error-box{
    background: rgba(239,68,68,.10);
    border:1px solid rgba(239,68,68,.28);
    color:#fca5a5;
    border-radius:12px; padding:.8rem 1rem; margin-top:1rem;
  }
  .error-box ul{ margin:0; padding-left:1.2rem; }

  /* ===== Botones de acci√≥n ===== */
  .actions{
    display:flex;
    gap:.75rem;
    margin-top:.3rem;
  }

  .actions .btn-primary,
  .actions .btn-ghost{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    height:48px;
    padding:0 1rem;
    border-radius:12px;
    font-weight:700;
    text-decoration:none;
    line-height:1;
    box-sizing:border-box;
    flex:1;
  }

  /* Estilo bot√≥n primario */
  .actions .btn-primary{
    background: linear-gradient(135deg,#10b981,#059669);
    color:#fff;
    border:0;
    box-shadow:0 10px 24px rgba(16,185,129,.25);
    transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
  }
  .actions .btn-primary:hover{ transform:translateY(-1px); filter:brightness(1.03); }

  /* Estilo bot√≥n ghost */
  .actions .btn-ghost{
    background: rgba(255,255,255,.08);
    color: #e8edf7;
    border:1px solid rgba(255,255,255,.16);
    transition: background .15s ease, border-color .15s ease, filter .15s ease;
  }
  .actions .btn-ghost:hover{
    background: rgba(255,255,255,.12);
    border-color: rgba(255,255,255,.22);
  }

  /* En m√≥vil, ambos ocupan todo el ancho */
  @media (max-width:520px){
    .actions .btn-primary,
    .actions .btn-ghost{ flex:1; width:100%; }
  }

  .reset-footer{
    margin-top:1.1rem; padding-top:1rem;
    border-top:1px solid rgba(255,255,255,.08);
    text-align:center; color:var(--muted);
  }
  .reset-footer a{ font-weight:700; }

  @media (max-width:480px){
    .reset-card{ padding:18px; }
  }

  .password-strength {
    font-size: 0.85rem;
    margin-top: 0.25rem;
    color: var(--muted);
  }

  .password-match {
    font-size: 0.85rem;
    margin-top: 0.25rem;
  }
  
  .password-match.match { color: #10b981; }
  .password-match.no-match { color: #ef4444; }
</style>
{% endblock %}

{% block content %}
<div class="reset-wrap">
  <div class="reset-card">
    <!-- Logo -->
    <div class="reset-logo" aria-hidden="true">
      <span style="font-size:2rem">üîê</span>
    </div>

    <h1 class="reset-title">Nueva contrase√±a</h1>
    <p class="reset-sub">Ingres√° tu nueva contrase√±a para restablecer el acceso</p>

    {% if errores %}
      <div class="error-box" role="alert">
        <ul>{% for e in errores %}<li>{{ e }}</li>{% endfor %}</ul>
      </div>
    {% endif %}

    <form class="form" method="post" action="{{ url_for('auth.reset_password', token=token) }}" autocomplete="on" novalidate>
      <!-- Nueva contrase√±a -->
      <div class="field">
        <label for="password">Nueva contrase√±a</label>
        <div class="control">
          <span class="icon">üîí</span>
          <input id="password" type="password" name="password"
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="new-password"
                 minlength="6">
          <button class="toggle-pass" type="button" id="showHideBtn1" aria-controls="password" aria-pressed="false">Ver</button>
        </div>
        <div class="password-strength">M√≠nimo 6 caracteres</div>
      </div>

      <!-- Confirmar contrase√±a -->
      <div class="field">
        <label for="confirm_password">Confirmar contrase√±a</label>
        <div class="control">
          <span class="icon">üîí</span>
          <input id="confirm_password" type="password" name="confirm_password"
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="new-password"
                 minlength="6">
          <button class="toggle-pass" type="button" id="showHideBtn2" aria-controls="confirm_password" aria-pressed="false">Ver</button>
        </div>
        <div class="password-match" id="passwordMatch"></div>
      </div>

      <!-- Botones -->
      <div class="actions">
        <a class="btn-ghost" href="{{ url_for('auth.login') }}">Cancelar</a>
        <button class="btn-primary" type="submit">Actualizar contrase√±a ‚Üí</button>
      </div>

      <div class="reset-footer">
        ¬øProblema con el enlace?
        <a href="{{ url_for('auth.forgot_password') }}">Solicita uno nuevo</a>
      </div>
    </form>
  </div>
</div>

<script>
  // Toggle de mostrar/ocultar contrase√±a
  function setupPasswordToggle(inputId, btnId) {
    const input = document.getElementById(inputId);
    const btn = document.getElementById(btnId);
    if (!input || !btn) return;

    btn.addEventListener('click', () => {
      const show = input.type === 'password';
      input.type = show ? 'text' : 'password';
      btn.textContent = show ? 'Ocultar' : 'Ver';
      btn.setAttribute('aria-pressed', show ? 'true' : 'false');
      input.focus();
    });
  }

  setupPasswordToggle('password', 'showHideBtn1');
  setupPasswordToggle('confirm_password', 'showHideBtn2');

  // Validaci√≥n de coincidencia de contrase√±as
  const password = document.getElementById('password');
  const confirmPassword = document.getElementById('confirm_password');
  const passwordMatch = document.getElementById('passwordMatch');

  function checkPasswordMatch() {
    if (!confirmPassword.value) {
      passwordMatch.textContent = '';
      passwordMatch.className = 'password-match';
      return;
    }

    if (password.value === confirmPassword.value) {
      passwordMatch.textContent = '‚úì Las contrase√±as coinciden';
      passwordMatch.className = 'password-match match';
    } else {
      passwordMatch.textContent = '‚úó Las contrase√±as no coinciden';
      passwordMatch.className = 'password-match no-match';
    }
  }

  password.addEventListener('input', checkPasswordMatch);
  confirmPassword.addEventListener('input', checkPasswordMatch);

  // Validaci√≥n al enviar el formulario
  document.querySelector('form').addEventListener('submit', function(e) {
    if (password.value !== confirmPassword.value) {
      e.preventDefault();
      alert('Las contrase√±as no coinciden.');
      confirmPassword.focus();
    }
  });
</script>
{% endblock %}